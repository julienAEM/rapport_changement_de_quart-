<script>
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxaGBM2UyvLY0cFXJkzYpFsJpXi2uGuzhFi7n6N5SwWrLkxWFWbYKkOe7lDPIQzyoTf0A/exec';

  // ENVOI (POST) vers la feuille cible
  function sendToHub(payload, SHEET_KEY) {
    const body = Object.assign({_sheet: SHEET_KEY}, payload);
    return fetch(ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    }).then(r => r.json());
  }

  // LECTURE (GET) d’une feuille précise
  function fetchFromHub(SHEET_KEY) {
    return fetch(`${ENDPOINT}?sheet=${encodeURIComponent(SHEET_KEY)}`)
      .then(r => r.json());
  }
</script>
<!DOCTYPE html>
<!--
  Page d'accueil pour les formulaires de changement de quart et de rotation.
  Cette version met à jour les étiquettes des boutons pour plus de clarté,
  ajoute "Résumé" devant les formulaires de rotation et propose un menu
  déroulant stylisé pour accéder rapidement à un rapport en cours d'écriture.
-->
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Changement de quart – Accueil</title>
  <style>
    :root {
      --primary-color: #253746;
      --secondary-color: #324e67;
      --accent-color: #0078C8;
      --text-light: #ffffff;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: var(--primary-color);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      text-align: center;
      background: var(--secondary-color);
      padding: 2rem 3rem;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    h1 {
      margin-top: 0;
      margin-bottom: 1.5rem;
    }
    .nav-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }
    .nav-buttons a, .nav-buttons select {
      display: inline-block;
      padding: 0.8rem 1.6rem;
      background: var(--accent-color);
      color: var(--text-light);
      border-radius: 4px;
      text-decoration: none;
      font-size: 1rem;
      border: none;
      cursor: pointer;
    }
    .nav-buttons a:hover, .nav-buttons select:hover {
      background: #005fa0;
    }
    /* Amélioration visuelle du menu déroulant pour qu'il ressemble aux autres boutons */
    .nav-buttons select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1rem;
    }
    .nav-buttons select option {
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Changement de quart – Accueil</h1>
    <div class="nav-buttons">
      <!-- Boutons vers les différents formulaires -->
      <a href="nouveau_quart_superviseur.html">Changement de quart (opération)</a>
      <a href="quart_control.html">Changement de quart (salle de contrôle)</a>
      <a href="rotation_superviseur.html">Résumé rotation (superviseur)</a>
      <a href="rotation_control.html">Résumé rotation (salle de contrôle)</a>
      <a href="rapport_multi_search.html">Consulter les rapports (base de données)</a>
      <!-- Menu déroulant stylisé pour accéder à un rapport en cours d'écriture -->
      <select id="resumeLinks" onchange="if(this.value) location.href=this.value;">
        <option value="">— Consulter un rapport en cours —</option>
        <option value="nouveau_quart_superviseur.html">Changement de quart (opération)</option>
        <option value="quart_control.html">Changement de quart (salle de contrôle)</option>
        <option value="rotation_superviseur.html">Résumé rotation (superviseur)</option>
        <option value="rotation_control.html">Résumé rotation (salle de contrôle)</option>
      </select>
      <a href="admin.html">Admin</a>
    </div>
  </div>
  <!-- Script de rafraîchissement automatique pour recharger la page d'accueil -->
  <script>
    (function() {
      var REFRESH_INTERVAL = 30 * 60 * 1000;
      var COUNTDOWN_SECONDS = 20;
      var refreshTimer;
      function startRefreshTimer() {
        refreshTimer = setTimeout(promptRefresh, REFRESH_INTERVAL);
      }
      function promptRefresh() {
        var overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.background = 'rgba(0,0,0,0.6)';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        overlay.style.zIndex = '9999';
        var modal = document.createElement('div');
        modal.style.background = '#ffffff';
        modal.style.padding = '2rem';
        modal.style.borderRadius = '8px';
        modal.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
        modal.style.textAlign = 'center';
        var msg = document.createElement('p');
        var remaining = COUNTDOWN_SECONDS;
        msg.textContent = 'Une mise à jour sera appliquée dans ' + remaining + ' secondes.';
        modal.appendChild(msg);
        var btnUpdate = document.createElement('button');
        btnUpdate.textContent = 'Mettre à jour maintenant';
        btnUpdate.style.marginRight = '1rem';
        var btnLater = document.createElement('button');
        btnLater.textContent = 'Plus tard';
        modal.appendChild(btnUpdate);
        modal.appendChild(btnLater);
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        var interval = setInterval(function() {
          remaining--;
          msg.textContent = 'Une mise à jour sera appliquée dans ' + remaining + ' secondes.';
          if (remaining <= 0) {
            clearInterval(interval);
            triggerRefresh();
          }
        }, 1000);
        btnUpdate.onclick = function() {
          clearInterval(interval);
          triggerRefresh();
        };
        btnLater.onclick = function() {
          clearInterval(interval);
          document.body.removeChild(overlay);
          startRefreshTimer();
        };
      }
      function triggerRefresh() {
        window.location.reload(true);
      }
      document.addEventListener('DOMContentLoaded', function() {
        startRefreshTimer();
      });
    })();
  </script>
</body>
</html>
