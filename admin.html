<!DOCTYPE html>
<!--
  Version étendue de la page d'administration permettant, en plus de gérer les
  listes et le code d'accès, de réinitialiser la base de données des rapports.
  Lorsque l'administrateur clique sur le bouton de réinitialisation, toutes
  les clés localStorage utilisées pour enregistrer les rapports (rapports,
  rapportsControl, rotationsSuperviseur et rotationsControl) sont supprimées
  après confirmation. Cette opération supprime uniquement les données de
  rapport et ne touche pas aux listes de superviseurs, chefs d'équipe, quarts
  et courriels.
-->
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Administration – Gestion des listes et base de données</title>
  <style>
    :root {
      --primary-color: #253746;
      --secondary-color: #324e67;
      --accent-color: #0078C8;
      --text-light: #ffffff;
      --field-bg: #f5f5f5;
    }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: var(--primary-color); color: var(--text-light); }
    .wrapper { max-width: 800px; margin: 2rem auto; background: var(--secondary-color); border-radius: 8px; padding: 2rem; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    h1 { margin-top: 0; margin-bottom: 1rem; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    textarea { width: 100%; height: 120px; padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; background: var(--field-bg); color: #333; }
    input[type="password"] { width:100%; padding:0.6rem; border:1px solid #ccc; border-radius:4px; background: var(--field-bg); color:#333; }
    button { margin-top: 1rem; padding: 0.7rem 1.4rem; background: var(--accent-color); color: var(--text-light); border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #005fa0; }
  </style>
</head>
<body>
  <div id="adminContent" class="wrapper" style="display:none;">
    <h1>Administration – Gestion des listes et base de données</h1>
    <button type="button" onclick="window.location.href='index.html'">Retour à l'accueil</button>
    <p>Modifiez ci-dessous les listes utilisées pour les menus déroulants du site. Chaque valeur doit être sur une nouvelle ligne.</p>
    <label for="teamLeadList">Liste des chefs d'équipe :</label>
    <textarea id="teamLeadList">Étienne Picard
David Michaud
Danick Deschenes
Samuel Boucher
Jean-Chrystophe Vallée</textarea>
    <button type="button" onclick="saveTeamLeadList()">Enregistrer la liste des chefs d'équipe</button>
    <label for="supervisorList">Liste des superviseurs :</label>
    <textarea id="supervisorList">Vincent Lévesque
Olivier Chrétien</textarea>
    <button type="button" onclick="saveSupervisorList()">Enregistrer la liste des superviseurs</button>
    <label for="shiftList">Liste des quarts :</label>
    <textarea id="shiftList">Jour
Nuit</textarea>
    <button type="button" onclick="saveShiftList()">Enregistrer la liste des quarts</button>

    <!-- Liste des opérateurs pour la salle de contrôle -->
    <label for="operatorList">Liste des opérateurs :</label>
    <textarea id="operatorList">Serge Landry; Raymond Émond; Vincent Morin; Éric-Hugo Bastien; Samuel Boucher; Vincent Lévesque; Olivier Chrétien      
    </textarea>
    <button type="button" onclick="saveOperatorList()">Enregistrer la liste des opérateurs</button>
    <h2>Liste des destinataires pour l'envoi des rapports</h2>
    <p>Entrez les adresses courriel auxquelles les rapports doivent être envoyés automatiquement, séparées par des points-virgules ou des retours à la ligne.</p>
    <label for="emailList">Adresses courriel :</label>
    <textarea id="emailList">sbeaulieu@aemhpa.com; lpbernier@aemhpa.com; jaubert@aemhpa.com; yyaddaden@aemhpa.com; cdumont@aemhpa.com; macharron@aemhpa.com; chache@aemhpa.com; mcdugas@aemhpa.com; dnoel@aemhpa.com; vlevesque@aemhpa.com; ochretien@aemhpa.com>; asamson@aemhpa.com; gombola@aemhpa.com; sseyer@aemhpa.com; msergerie@aemhpa.com; dmichaud@aemhpa.com; ddeschenes@aemhpa.com; sboucher@aemhpa.com; jcvallee@aemhpa.com; epicard@aemhpa.com
    </textarea>
    <button type="button" onclick="saveEmailList()">Enregistrer les courriels</button>
    <h2>Modifier le code d’accès</h2>
    <label for="newPassword">Nouveau code :</label>
    <input type="password" id="newPassword">
    <button type="button" onclick="updatePassword()">Enregistrer</button>
    <h2>Réinitialiser la base de données des rapports</h2>
    <p>Cette opération supprimera toutes les données de rapport enregistrées (changement de quart et de rotation, superviseur et salle de contrôle). Les listes de noms et courriels ne seront pas affectées.</p>
    <button type="button" onclick="resetReports()">Réinitialiser les rapports</button>
  </div>
  <div id="accessDenied" class="wrapper" style="display:none;">
    <h1>Accès refusé</h1>
    <p>Vous n'avez pas l'autorisation d'accéder à cette page.</p>
  </div>
  <script>
    // Afficher le contenu administrateur après vérification du mot de passe
    document.addEventListener('DOMContentLoaded', function() {
      var storedPwd = localStorage.getItem('adminPassword') || 'admin';
      var pwd = prompt('Veuillez entrer le mot de passe administrateur :');
      if (pwd === storedPwd) {
        document.getElementById('adminContent').style.display = 'block';
        // Charger les listes sauvegardées
        var storedEmails = localStorage.getItem('emailList') || '';
        document.getElementById('emailList').value = storedEmails;
        var storedSupList = localStorage.getItem('supervisorList');
        if (storedSupList !== null) {
          document.getElementById('supervisorList').value = storedSupList;
        }
        var storedShiftList = localStorage.getItem('shiftList');
        if (storedShiftList !== null) {
          document.getElementById('shiftList').value = storedShiftList;
        }
        var storedTeamLeads = localStorage.getItem('teamLeadList');
        if (storedTeamLeads !== null) {
          document.getElementById('teamLeadList').value = storedTeamLeads;
        }

        // Charger la liste des opérateurs si elle existe
        var storedOperators = localStorage.getItem('operatorList');
        if (storedOperators !== null) {
          document.getElementById('operatorList').value = storedOperators;
        }
      } else {
        document.getElementById('accessDenied').style.display = 'block';
      }
    });
    // Enregistrer un nouveau mot de passe
    function updatePassword() {
      var newPwd = document.getElementById('newPassword').value;
      if (newPwd) {
        localStorage.setItem('adminPassword', newPwd);
        alert('Nouveau code enregistré.');
      } else {
        alert('Veuillez saisir un nouveau code.');
      }
    }
    // Sauvegarder la liste des courriels dans localStorage
    function saveEmailList() {
      var emails = document.getElementById('emailList').value.trim();
      localStorage.setItem('emailList', emails);
      alert('Liste des courriels enregistrée.');
    }
    // Sauvegarder la liste des superviseurs
    function saveSupervisorList() {
      var sup = document.getElementById('supervisorList').value.trim();
      localStorage.setItem('supervisorList', sup);
      alert('Liste des superviseurs enregistrée.');
    }
    // Sauvegarder la liste des quarts
    function saveShiftList() {
      var shift = document.getElementById('shiftList').value.trim();
      localStorage.setItem('shiftList', shift);
      alert('Liste des quarts enregistrée.');
    }
    // Sauvegarder la liste des chefs d'équipe
    function saveTeamLeadList() {
      var leads = document.getElementById('teamLeadList').value.trim();
      localStorage.setItem('teamLeadList', leads);
      alert("Liste des chefs d'équipe enregistrée.");
    }

    // Sauvegarder la liste des opérateurs dans localStorage
    function saveOperatorList() {
      var ops = document.getElementById('operatorList').value.trim();
      localStorage.setItem('operatorList', ops);
      alert('Liste des opérateurs enregistrée.');
    }
    // Réinitialiser toutes les listes de rapports (ne supprime pas les listes de noms ou le mot de passe)
    function resetReports() {
      if (confirm('Êtes-vous sûr de vouloir supprimer toutes les données de rapport ? Cette action est irréversible.')) {
        localStorage.removeItem('rapports');
        localStorage.removeItem('rapportsControl');
        localStorage.removeItem('rotationsSuperviseur');
        localStorage.removeItem('rotationsControl');
        alert('Les données de rapport ont été supprimées.');
      }
    }
  </script>
  <!-- Script de rafraîchissement automatique pour recharger l'interface d'administration -->
  <script>
    (function() {
      var REFRESH_INTERVAL = 30 * 60 * 1000;
      var COUNTDOWN_SECONDS = 20;
      var refreshTimer;
      function startRefreshTimer() {
        refreshTimer = setTimeout(promptRefresh, REFRESH_INTERVAL);
      }
      function promptRefresh() {
        var overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.background = 'rgba(0,0,0,0.6)';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        overlay.style.zIndex = '9999';
        var modal = document.createElement('div');
        modal.style.background = '#ffffff';
        modal.style.padding = '2rem';
        modal.style.borderRadius = '8px';
        modal.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
        modal.style.textAlign = 'center';
        var msg = document.createElement('p');
        var remaining = COUNTDOWN_SECONDS;
        msg.textContent = 'Une mise à jour sera appliquée dans ' + remaining + ' secondes.';
        modal.appendChild(msg);
        var btnUpdate = document.createElement('button');
        btnUpdate.textContent = 'Mettre à jour maintenant';
        btnUpdate.style.marginRight = '1rem';
        var btnLater = document.createElement('button');
        btnLater.textContent = 'Plus tard';
        modal.appendChild(btnUpdate);
        modal.appendChild(btnLater);
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        var interval = setInterval(function() {
          remaining--;
          msg.textContent = 'Une mise à jour sera appliquée dans ' + remaining + ' secondes.';
          if (remaining <= 0) {
            clearInterval(interval);
            triggerRefresh();
          }
        }, 1000);
        btnUpdate.onclick = function() {
          clearInterval(interval);
          triggerRefresh();
        };
        btnLater.onclick = function() {
          clearInterval(interval);
          document.body.removeChild(overlay);
          startRefreshTimer();
        };
      }
      function triggerRefresh() {
        window.location.reload(true);
      }
      document.addEventListener('DOMContentLoaded', function() {
        startRefreshTimer();
      });
    })();
  </script>
</body>
</html>
